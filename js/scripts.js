"use strict";var apiKey="a983975bd7ff651e1c601fb29f627930",renderFilms=[],genres=[],pageNumber=1,movieListRef=document.querySelector("ul.movie-list");function createCardFunc(e,t,a){var n=document.createDocumentFragment(),r=document.createElement("li");r.classList.add("movie-list__item"),r.addEventListener("click",function(){activeDetailsPage(a,!1)});var i=document.createElement("a");i.classList.add("movie-list__link"),i.href="#";var o=document.createElement("img");o.classList.add("movie-list__image"),o.src="https://image.tmdb.org/t/p/original".concat(e),null===e&&(o.src="./images/No_image.jpg"),o.alt=t;var c=document.createElement("p");return c.classList.add("movie-list__text"),c.textContent=t,r.appendChild(i),i.appendChild(o),i.appendChild(c),n.appendChild(r),n}function fetchPopularMoviesList(e){var t="https://api.themoviedb.org/3/movie/popular?api_key=".concat(apiKey,"&language=ru-Ru&page=").concat(e);return fetch(t).then(function(e){return e.json()}).then(function(e){var t=e.results,a=document.createDocumentFragment();inputValue="",t.forEach(function(e){renderFilms.push(e),a.appendChild(createCardFunc(e.backdrop_path,e.title,e.id))}),movieListRef.append(a)}).catch(console.log)}function fetchGenres(){var e="https://api.themoviedb.org/3/genre/movie/list?api_key=".concat(apiKey);return fetch(e).then(function(e){return e.json()}).then(function(e){e.genres.forEach(function(e){return genres.push(e)})})}fetchGenres();var form=document.querySelector("#homePage__search"),input=document.querySelector("#homePage__search-input"),pagination=document.getElementById("homePage__pagination"),prevBtn=pagination.querySelector('[data-action = "prev"]'),nextBtn=pagination.querySelector('[data-action = "next"]'),pageValue=pagination.querySelector(".homePage__value"),inputValue="";pageValue.textContent=pageNumber;var errorMessage=document.createElement("p");function plaginationNavigation(e){var t=e.target;2===pageNumber&&prevBtn.classList.add("hidden"),t===prevBtn&&(pageNumber-=1,pageValue.textContent=pageNumber,""===inputValue?(movieListRef.innerHTML="",fetchPopularMoviesList(pageNumber)):fetchFilms(inputValue,pageNumber)),t===nextBtn&&(pageNumber+=1,pageValue.textContent=pageNumber,prevBtn.classList.remove("hidden"),""===inputValue?(movieListRef.innerHTML="",fetchPopularMoviesList(pageNumber)):fetchFilms(inputValue,pageNumber))}function searchFilms(e){pageNumber=1,e.preventDefault(),errorMessage.hidden=!0,""===(inputValue=input.value)?(resetPlagination(),fetchPopularMoviesList(pageNumber)):(resetPlagination(),fetchFilms(inputValue,pageNumber))}function eraseErroMesage(){errorMessage.hidden=!0}function resetPlagination(){movieListRef.innerHTML="",pageValue.textContent=pageNumber,prevBtn.classList.add("hidden")}function fetchFilms(n,r){""===n&&fetchPopularMoviesList();var e="https://api.themoviedb.org/3/search/movie?api_key=".concat(apiKey,"&language=en-US&query=").concat(n,"&page=").concat(r,"&include_adult=false");fetch(e).then(function(e){return e.json()}).then(function(e){var t=e.results;""!==n&&0===t.length&&(errorMessage.hidden=!1,setTimeout(eraseErroMesage,3e3),fetchPopularMoviesList(r)),movieListRef.innerHTML="";var a=document.createDocumentFragment();t.forEach(function(e){renderFilms.push(e),a.appendChild(createCardFunc(e.backdrop_path,e.title,e.id))}),movieListRef.append(a)}).catch(function(e){return console.log("ERROR"+e)}),input.value=""}errorMessage.setAttribute("id","homePage__search-error-message"),errorMessage.textContent="Sorry, no movie matches your request",errorMessage.hidden=!0,form.append(errorMessage);var selectFilm,homeRef=document.querySelector(".js-home"),libraryRef=document.querySelector(".js-library"),logoRef=document.querySelector(".site-logo"),homePageRef=document.querySelector("#homePage_show"),filmLibraryRef=document.querySelector(".js-filmLibrary"),detailsPageRef=document.querySelector("#js-detailsPage"),btnWatched=document.querySelector(".my-film-library-page__btn_watched"),btnQueue=document.querySelector(".my-film-library-page__btn_queue"),addQueueButton=document.querySelector("#js-addQueueButton"),addWatchedButton=document.querySelector("#js-addWatchedButton");function activeHomePage(){homePageRef.classList.remove("hide"),filmLibraryRef.classList.add("hide"),detailsPageRef.classList.add("hide"),libraryRef.classList.remove("selectPage"),homeRef.classList.add("selectPage"),pagination.removeEventListener("click",plaginationNavigation),pageNumber=1,resetPlagination(),fetchPopularMoviesList(pageNumber),pagination.addEventListener("click",plaginationNavigation),form.addEventListener("submit",searchFilms),addWatchedButton.removeEventListener("click",toggleToWatched),addQueueButton.removeEventListener("click",toggleToQueue),btnWatched.removeEventListener("click",drawWatchedFilmList),btnQueue.removeEventListener("click",drawQueueFilmList)}function activeLibraryPage(){homePageRef.classList.add("hide"),filmLibraryRef.classList.remove("hide"),detailsPageRef.classList.add("hide"),libraryRef.classList.add("selectPage"),homeRef.classList.remove("selectPage"),btnQueue.classList.add("active-btn"),drawQueueFilmList(),btnWatched.addEventListener("click",drawWatchedFilmList),btnQueue.addEventListener("click",drawQueueFilmList),pagination.removeEventListener("click",plaginationNavigation),form.removeEventListener("submit",searchFilms),addWatchedButton.removeEventListener("click",toggleToWatched),addQueueButton.removeEventListener("click",toggleToQueue)}function activeDetailsPage(t,e){homePageRef.classList.add("hide"),filmLibraryRef.classList.add("hide"),detailsPageRef.classList.remove("hide"),(selectFilm=renderFilms.find(function(e){return e.id===t})).itsLibraryFilm=e,showDetails(selectFilm),addWatchedButton.addEventListener("click",toggleToWatched),addQueueButton.addEventListener("click",toggleToQueue),pagination.removeEventListener("click",plaginationNavigation),form.removeEventListener("submit",searchFilms),btnWatched.removeEventListener("click",drawWatchedFilmList),btnQueue.removeEventListener("click",drawQueueFilmList)}logoRef.addEventListener("click",activeHomePage),homeRef.addEventListener("click",activeHomePage),libraryRef.addEventListener("click",activeLibraryPage),activeHomePage();var btnUpRef=document.querySelector(".btn_up");function goUp(){window.scrollTo({top:0,behavior:"smooth"})}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}btnUpRef.addEventListener("click",goUp);var addRemoveWatched=document.querySelector(".addRemoveWatched"),addRemoveQueue=document.querySelector(".addRemoveQueue"),svgChangeWatched=document.querySelector(".svg_W_addRemove"),svgChangeQueue=document.querySelector(".svg_Q_addRemove");function toggleToQueue(){var e,t=[],a=localStorage.getItem("filmsQueue");null!==a&&(e=t).push.apply(e,_toConsumableArray(JSON.parse(a)));t.find(function(e){return e.id===selectFilm.id})?t=t.filter(function(e){return e.id!==selectFilm.id}):t.push(selectFilm),localStorage.setItem("filmsQueue",JSON.stringify(t)),monitorButtonStatusText()}function toggleToWatched(){var e,t=[],a=localStorage.getItem("filmsWatched");null!==a&&(e=t).push.apply(e,_toConsumableArray(JSON.parse(a)));t.find(function(e){return e.id===selectFilm.id})?t=t.filter(function(e){return e.id!==selectFilm.id}):t.push(selectFilm),localStorage.setItem("filmsWatched",JSON.stringify(t)),monitorButtonStatusText()}function showDetails(e){document.querySelector(".detailsImg").setAttribute("src","https://image.tmdb.org/t/p/w500".concat(e.poster_path)),document.querySelector("#js-detailsTitle").textContent=e.title,document.querySelector("#js-vote").textContent=e.vote_average,document.querySelector("#js-popularity").textContent=e.popularity,document.querySelector("#js-originalTitle").textContent=e.original_title,document.querySelector("#js-genre").textContent=String(genres.filter(function(t){return e.genre_ids.find(function(e){return t.id===e})}).reduce(function(e,t){return e+"".concat(t.name,", ")},"")).slice(0,-2),document.querySelector("#js-detailsAboutText").textContent=e.overview,monitorButtonStatusText()}function monitorButtonStatusText(){addRemove(localStorage.getItem("filmsQueue"),"queue",addRemoveQueue),changeImgQueue(),addRemove(localStorage.getItem("filmsWatched"),"watched",addRemoveWatched),changeImgWatched()}function addRemove(e,t,a){null===e?a.textContent="Add to ".concat(t):JSON.parse(e).find(function(e){return e.id===selectFilm.id})?a.textContent="Delete from ".concat(t):a.textContent="Add to ".concat(t)}function changeImgWatched(){"Add to watched"===addWatchedButton.textContent.trim()?svgChangeWatched.setAttribute("href","./images/sprite1.svg#icon-video-camera-svgrepo-com"):svgChangeWatched.setAttribute("href","./images/sprite1.svg#icon-trash")}function changeImgQueue(){"Add to queue"===addQueueButton.textContent.trim()?svgChangeQueue.setAttribute("href","./images/sprite1.svg#icon-calendar-plus"):svgChangeQueue.setAttribute("href","./images/sprite1.svg#icon-calendar-minus")}var myFilmListRef=document.querySelector(".js-movie-list"),plugRef=document.querySelector(".plug"),clearList=function(){myFilmListRef.innerHTML="",plugRef.classList.remove("plug-show")},createLibraryCardFunc=function(e,t,a,n){var r=document.createElement("li");r.classList.add("movie-list__item"),r.addEventListener("click",function(){activeDetailsPage(a,!0)});var i=document.createElement("a");i.classList.add("movie-list__link"),i.href="#";var o=document.createElement("img");o.classList.add("movie-list__image"),o.src="https://image.tmdb.org/t/p/original".concat(e),o.alt=t;var c=document.createElement("p");c.classList.add("movie-list__text"),c.textContent=t;var s=document.createElement("span");return s.classList.add("movie-list__vote"),s.textContent=n,i.append(o,c,s),r.appendChild(i),r},drawQueueFilmList=function(){var i=document.createDocumentFragment(),e=localStorage.getItem("filmsQueue"),t=JSON.parse(e);if(btnQueue.classList.add("active-btn"),btnWatched.classList.remove("active-btn"),null!==e&&0!==t.length)return t.map(function(e){var t=e.backdrop_path,a=e.title,n=e.id,r=e.vote_average;i.appendChild(createLibraryCardFunc(t,a,n,r))}),clearList(),void myFilmListRef.appendChild(i);myFilmListRef.innerHTML="",plugRef.textContent="“You do not have to queue movies to watch. Add them.”",plugRef.classList.add("plug-show")},drawWatchedFilmList=function(){var i=document.createDocumentFragment(),e=localStorage.getItem("filmsWatched"),t=JSON.parse(e);if(btnQueue.classList.remove("active-btn"),btnWatched.classList.add("active-btn"),null!==e&&0!==t.length)return t.map(function(e){var t=e.id,a=e.backdrop_path,n=e.title,r=e.vote_average;i.appendChild(createLibraryCardFunc(a,n,t,r))}),clearList(),void myFilmListRef.appendChild(i);myFilmListRef.innerHTML="",plugRef.textContent="“You do not have to watched movies to watch. Add them.”",plugRef.classList.add("plug-show")};